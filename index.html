<!DOCTYPE>
<html>

  <head>
    <title>LD32 | Jim the Patriot</title>
  </head>

  <body>
    <div class="container">

    </div>
    <script src="jquery-2.1.3.min.js"></script>
    <script src="papaparse.min.js"></script>
    <script type="text/javascript">
      // everything is exposed in the global scope for the game dev's that wanna poke around (and cheat...)

      var $container;
      var currentNode;
      var nodes = {};

      // nodes['0'] = {
      //   id: 0,
      //   text: "Some text",
      //   children: [1, 2]
      // }
      //
      // nodes['1'] = {
      //   id: 1,
      //   text: "Some text two",
      //   children: []
      // }
      //
      // nodes['2'] = {
      //   id: 2,
      //   text: "Some text three!",
      //   children: [3, 4]
      // }
      //
      // nodes['3'] = {
      //   id: 3,
      //   text: "Some text four!",
      //   children: []
      // }
      //
      // nodes['4'] = {
      //   id: 4,
      //   text: "Some text five!",
      //   children: []
      // }

      function init() {
        Papa.parse('/data.csv', {
          download: true,
          complete: function(results) {
            console.log("CSV data downloaded");
            var data = results.data;
            data.forEach(function(element, index, array) {
              index++;
              nodes[index.toString()] = {
                id: index,
                text: element[0],
                children: element[1].split(",")
              }
            });
            console.log("Nodes configured");
            currentNode = nodes['1'];
            addNode(currentNode);
            $('#' + currentNode.id).on('click', function(e) {
              onNodeClick(currentNode);
            });
          }
        });
      }

      function onNodeClick(node) {
        console.log("Clicked " + node.id);
        currentNode = node;
        $container.empty();
        var c = node.children;
        c.forEach(function(element, index, array) {
          var cNode = nodes[element.toString()];
          addNode(cNode);
          $('#' + cNode.id).on('click', function(e) {
            onNodeClick(cNode);
          });
        });
      }

      function addNode(node) {
        $container.append('<p id=' + node.id + '>' + node.text + '</p>');
      }

      $(document).on('ready', function(){
        $container = $('.container');
        init();
      });

    </script>
  </body>

</html>
